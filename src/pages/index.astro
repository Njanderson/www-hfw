---
import BaseLayout from '@layouts/BaseLayout.astro'
import PostBlurb from '$components/post-blurb/PostBlurb.astro'
import LinkBlurb from '$components/LinkBlurb.astro'
import Slideshow from '../components/slideshow/Slideshow.jsx'
import slides from '@data/slideshow.json'

import volunteer_data from '@data/volunteer.json'

const posts = Astro.fetchContent('@pages/posts/*.md')
  .filter((post) => !!post.order)
  .sort((a,b) => (a.order - b.order));
const posts_length = posts.length;
const postColumns = (index) => {
  if (posts_length % 3 === 1 && index > posts_length - 2) {
    return {span: 'md:col-span-6', cols: 3}
  } else if (posts_length % 3 === 2 && index > posts_length - 3) {
    return {span: 'md:col-span-3', cols: 2}
  } else {
    return {span: 'md:col-span-2', cols: 1}
  }
}
---

<BaseLayout title="Home">
  <div class="grid grid-cols-1 sm:grid-cols-6 gap-4 sm:gap-6 w-full">

    <!-- INFO BLOCK -->
    <section itemscope itemtype="https://schema.org/Event" class="sm:col-span-3 content-container" >
      <div class="flex flex-col justify-between items-center h-full text-2xl sm:text-3xl  font-medium tracking-wide">
        <span class="block text-title-primary-color text-center mb-2 hidden md:block font-emphasis" itemprop="name">
          <span class="text-gray-300">HONK!</span> FEST WEST
        </span>
        <div class="flex flex-col lg:flex-row justify-center items-center md:mb-2 w-full">
          <span class="hidden sm:block mb-2 lg:mb-0 text-gray-300 tracking-normal md:mr-2 font-emphasis text-center">
            <time itemprop="startDate" content="2021-09-18">SEPTEMBER 18TH, 2021</time>
          </span>
          <a href="/festival" class="w-full text-center md:w-auto text-2xl block font-base rounded antialiased text-gray-200 font-bold flex-none bg-accent-color bg-opacity-80 px-2 hover:bg-opacity-90">
            » Festival Info
          </a>
        </div>
        <span class="block text-title-primary-color text-center hidden md:block font-emphasis" itemprop="location">
          <span class="text-gray-300">COLUMBIA CITY</span>, SEATTLE, WA
        </span>
      </div>
    </section>

    <!-- NEWSLETTER BLOCK -->
    <section class="sm:col-span-3 content-container">
      <div class="flex flex-col items-center h-full justify-center font-emphasis font-medium">
        <span class="block text-title-primary-color mb-2 tracking-wide text-2xl md:text-3xl">
          NEWSLETTER
        </span>
        <form 
          action="https://honkfestwest.us4.list-manage.com/subscribe/post?u=ef3f62323075a304e4a1428e3&amp;id=b6e69bd855" 
          method="post" 
          id="mc-embedded-subscribe-form" 
          name="mc-embedded-subscribe-form" 
          class="w-full p-0 m-0" 
          target="_blank" 
          novalidate="">

          <div id="mc_embed_signup_scroll" class="flex flex-col justify-center items-center w-full">
            <div class="hidden md:flex w-full md:mb-4 justify-center items-center">
              <label class="text-gray-300 mr-2 mb-0 block text-center text-2xl md:text-3xl" for="mce-EMAIL">
                EMAIL:
              </label>
              <input type="email" value="" name="EMAIL" class="bg-white bg-opacity-70 block w-full font-base text-lg px-2 py-1" id="mce-EMAIL">
            </div>
            <div id="mce-responses" class="clear">
              <div class="hidden" id="mce-error-response"></div>
              <div class="hidden" id="mce-success-response"></div>
            </div>
            <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
            <div style="position: absolute; left: -5000px" aria-hidden="true">
              <input type="text" name="b_ef3f62323075a304e4a1428e3_b6e69bd855" tabindex="-1" value="">
            </div>

            <input 
              type="submit" 
              value="Subscribe" 
              name="subscribe" 
              id="mc-embedded-subscribe" 
              class="border-2 border-gray-400 text-gray-100 bg-gray-500 rounded font-base text-base sm:text-lg px-2 py-1">
          </div>
        </form>
      </div>
    </section>

    <!-- POST BLURBS -->
    {posts.map((post, index) => (
      <article class={`w-full content-container sm:col-span-6 ${postColumns(index).span}`}>
        <PostBlurb post={post} cols={postColumns(index).cols}/>
      </article>
    ))}

    <!-- LINK BLURBS -->
    <section class="sm:col-span-6 md:col-span-2 content-container">
      <LinkBlurb title="About" href="/about">
        HONK! Fest West is an accessible community music festival 
        driven by the energetic performances of street bands in public spaces.
      </LinkBlurb>
    </section>
    <section class="sm:col-span-6 md:col-span-2 content-container">
      <LinkBlurb title="Volunteer" href="/volunteer">
        If you want to volunteer, and help make HONK! Fest West magic, please 
        <a class="text-accent-color font-bold" href={volunteer_data.form_url}>
          APPLY HERE
        </a>
        and Thank You!!
      </LinkBlurb>
    </section>
    <section class="sm:col-span-6 md:col-span-2 content-container">
      <LinkBlurb title="Donate" href="/donate">
        Your contributions help make this event possible. 
        Through the generous efforts of our shared community, 
        we’ll keep bringing music to the streets and parks of Seattle’s neighborhoods.
      </LinkBlurb>
    </section>

    <!-- SLIDESHOW -->
    <div class="sm:col-span-6 content-container">
      <Slideshow slides={slides} client:visible  />
    </div>

    <!-- SUPPORT DUAMISH  -->
    <div class="sm:col-span-6 content-container">
      <p class="content font-base text-gray-700 italic">
        H!FW acknowledges that we are on the traditional land of the first people of Seattle
        — the Duwamish People past and present — and honor with gratitude the land itself,
        the Duwamish Tribe, and the Coast Salish people.
      </p>
      <br/>
      <a class="font-base link text-accent-color font-bold text-base sm:text-lg" href="https://www.duwamishtribe.org/donate">
        » Please support the Duwamish Tribe
      </a>
    </div>

  </div>
</BaseLayout>

